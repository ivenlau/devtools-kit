# 05-æµ‹è¯•ç­–ç•¥ä¸å¼€å‘æµç¨‹

## ä¸€ã€æµ‹è¯•ç­–ç•¥æ¦‚è¿°

### 1.1 æµ‹è¯•é‡‘å­—å¡”

```
              /\
             /  \
            / E2E\          10% - å…³é”®ç”¨æˆ·æµç¨‹
           /------\
          /        \
         /é›†æˆæµ‹è¯•  \      20% - ç»„ä»¶é›†æˆ
        /----------\
       /            \
      /  å•å…ƒæµ‹è¯•    \    70% - å·¥å…·å‡½æ•°ã€ç»„ä»¶
     /--------------\
```

### 1.2 æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- **å•å…ƒæµ‹è¯•**: 80%+ è¦†ç›–ç‡
- **é›†æˆæµ‹è¯•**: 60%+ è¦†ç›–ç‡
- **E2Eæµ‹è¯•**: è¦†ç›–æ ¸å¿ƒç”¨æˆ·æµç¨‹
- **å…³é”®è·¯å¾„**: 100% è¦†ç›–

---

## äºŒã€å•å…ƒæµ‹è¯•

### 2.1 å·¥å…·å‡½æ•°æµ‹è¯•

```typescript
// tests/unit/lib/encoders/base64.test.ts
import { describe, it, expect } from 'vitest';
import { base64Encode, base64Decode, isBase64 } from '@/lib/encoders/base64';

describe('Base64 Encoder', () => {
  describe('base64Encode', () => {
    it('should encode simple text', () => {
      expect(base64Encode('Hello')).toBe('SGVsbG8=');
      expect(base64Encode('World')).toBe('V29ybGQ=');
    });

    it('should encode empty string', () => {
      expect(base64Encode('')).toBe('');
    });

    it('should encode special characters', () => {
      expect(base64Encode('ä½ å¥½ä¸–ç•Œ')).toBe('5L2g5aW95LiW55WM');
      expect(base64Encode('ğŸ‰')).toBe('8J+YjQ==');
    });

    it('should handle UTF-8 encoding', () => {
      expect(base64Encode('ä¸­æ–‡å­—ç¬¦', 'utf-8')).toBe('5Lit5paH5YyW');
    });
  });

  describe('base64Decode', () => {
    it('should decode base64 string', () => {
      expect(base64Decode('SGVsbG8=')).toBe('Hello');
      expect(base64Decode('V29ybGQ=')).toBe('World');
    });

    it('should decode Chinese characters', () => {
      expect(base64Decode('5L2g5aW9')).toBe('ä½ å¥½');
    });

    it('should throw error on invalid base64', () => {
      expect(() => base64Decode('invalid!base64')).toThrow('æ— æ•ˆçš„Base64å­—ç¬¦ä¸²');
    });

    it('should handle empty string', () => {
      expect(base64Decode('')).toBe('');
    });
  });

  describe('isBase64', () => {
    it('should return true for valid base64', () => {
      expect(isBase64('SGVsbG8=')).toBe(true);
      expect(isBase64('V29ybGQ=')).toBe(true);
    });

    it('should return false for invalid base64', () => {
      expect(isBase64('invalid!')).toBe(false);
      expect(isBase64('Hello World')).toBe(false);
    });

    it('should handle empty string', () => {
      expect(isBase64('')).toBe(true); // ç©ºå­—ç¬¦ä¸²æ˜¯åˆæ³•çš„base64
    });
  });
});
```

### 2.2 æ ¼å¼åŒ–å·¥å…·æµ‹è¯•

```typescript
// tests/unit/lib/parsers/json.test.ts
import { describe, it, expect } from 'vitest';
import { formatJson, minifyJson, validateJson, jsonToCsv } from '@/lib/parsers/json';

describe('JSON Parser', () => {
  describe('formatJson', () => {
    it('should format JSON with 2 spaces', () => {
      const input = '{"name":"John","age":30}';
      const output = formatJson(input, { indent: 2, sortKeys: false });
      expect(output).toBe('{\n  "name": "John",\n  "age": 30\n}');
    });

    it('should format JSON with 4 spaces', () => {
      const input = '{"name":"John"}';
      const output = formatJson(input, { indent: 4, sortKeys: false });
      expect(output).toBe('{\n    "name": "John"\n}');
    });

    it('should sort keys when option is enabled', () => {
      const input = '{"z":1,"a":2,"m":3}';
      const output = formatJson(input, { indent: 2, sortKeys: true });
      expect(output).toBe('{\n  "a": 2,\n  "m": 3,\n  "z": 1\n}');
    });

    it('should handle nested objects', () => {
      const input = '{"user":{"name":"John","age":30}}';
      const output = formatJson(input, { indent: 2, sortKeys: false });
      expect(output).toContain('{\n  "user": {\n    "name": "John",\n    "age": 30\n  }\n}');
    });

    it('should return error for invalid JSON', () => {
      const input = '{"invalid": }';
      const { result, error } = formatJson(input, { indent: 2, sortKeys: false });
      expect(result).toBe('');
      expect(error).not.toBeNull();
      expect(error?.message).toContain('JSON');
    });
  });

  describe('minifyJson', () => {
    it('should minify JSON', () => {
      const input = '{\n  "name": "John",\n  "age": 30\n}';
      const { result, error } = minifyJson(input);
      expect(result).toBe('{"name":"John","age":30}');
      expect(error).toBeNull();
    });

    it('should handle nested objects', () => {
      const input = '{\n  "user": {\n    "name": "John"\n  }\n}';
      const { result } = minifyJson(input);
      expect(result).toBe('{"user":{"name":"John"}}');
    });
  });

  describe('jsonToCsv', () => {
    it('should convert simple array to CSV', () => {
      const json = '[{"name":"John","age":30},{"name":"Jane","age":25}]';
      const csv = jsonToCsv(json);
      expect(csv).toBe('name,age\nJohn,30\nJane,25');
    });

    it('should handle missing fields', () => {
      const json = '[{"name":"John"},{"name":"Jane","age":25}]';
      const csv = jsonToCsv(json);
      expect(csv).toBe('name,age\nJohn,\nJane,25');
    });

    it('should escape commas in values', () => {
      const json = '[{"address":"New York, NY"}]';
      const csv = jsonToCsv(json);
      expect(csv).toBe('address\n"New York, NY"');
    });

    it('should convert single object to CSV', () => {
      const json = '{"name":"John","age":30}';
      const csv = jsonToCsv(json);
      expect(csv).toBe('name,age\nJohn,30');
    });
  });
});
```

### 2.3 ç»„ä»¶æµ‹è¯•

```typescript
// tests/unit/components/ui/Button.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from '@/components/ui/Button';

describe('Button Component', () => {
  it('should render button with text', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('should call onClick when clicked', () => {
    const handleClick = vi.fn();
    render(<Button onClick={handleClick}>Click me</Button>);

    fireEvent.click(screen.getByText('Click me'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('should not call onClick when disabled', () => {
    const handleClick = vi.fn();
    render(
      <Button onClick={handleClick} disabled>
        Click me
      </Button>
    );

    fireEvent.click(screen.getByText('Click me'));
    expect(handleClick).not.toHaveBeenCalled();
  });

  it('should show loading spinner', () => {
    render(<Button loading>Click me</Button>);
    expect(screen.getByRole('button')).toContainElement(screen.getByText('Click me'));
  });

  it('should render with icon', () => {
    const Icon = () => <span data-testid="icon">Icon</span>;
    render(<Button icon={<Icon />}>Click me</Button>);

    expect(screen.getByTestId('icon')).toBeInTheDocument();
  });

  it('should apply variant classes', () => {
    const { rerender } = render(<Button variant="primary">Click</Button>);
    expect(screen.getByRole('button')).toHaveClass('bg-blue-600');

    rerender(<Button variant="danger">Click</Button>);
    expect(screen.getByRole('button')).toHaveClass('bg-red-600');
  });
});
```

### 2.4 è‡ªå®šä¹‰Hooksæµ‹è¯•

```typescript
// tests/unit/hooks/useDebounce.test.ts
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
import { renderHook, act } from '@testing-library/react';
import { useDebounce } from '@/hooks/useDebounce';

describe('useDebounce Hook', () => {
  beforeEach(() => {
    vi.useFakeTimers();
  });

  afterEach(() => {
    vi.restoreAllMocks();
  });

  it('should return initial value immediately', () => {
    const { result } = renderHook(() => useDebounce('initial', 500));
    expect(result.current).toBe('initial');
  });

  it('should debounce value changes', () => {
    const { result, rerender } = renderHook(
      (value: string) => useDebounce(value, 500),
      { initialProps: 'initial' }
    );

    expect(result.current).toBe('initial');

    rerender('updated');
    expect(result.current).toBe('initial'); // è¿˜æ²¡æœ‰æ›´æ–°

    act(() => {
      vi.advanceTimersByTime(500);
    });

    expect(result.current).toBe('updated');
  });

  it('should reset timer on rapid updates', () => {
    const { result, rerender } = renderHook(
      (value: string) => useDebounce(value, 500),
      { initialProps: 'initial' }
    );

    rerender('update1');
    act(() => {
      vi.advanceTimersByTime(300);
    });

    rerender('update2');
    act(() => {
      vi.advanceTimersByTime(300);
    });

    expect(result.current).toBe('initial'); // è¿˜æ²¡æœ‰åˆ°500ms

    act(() => {
      vi.advanceTimersByTime(200);
    });

    expect(result.current).toBe('update2');
  });
});
```

---

## ä¸‰ã€é›†æˆæµ‹è¯•

### 3.1 å·¥å…·ç»„ä»¶é›†æˆæµ‹è¯•

```typescript
// tests/integration/tools/json.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, waitFor, fireEvent } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { JsonTool } from '@/components/tools/json/JsonTool';

describe('JSON Tool Integration', () => {
  it('should format JSON when user types', async () => {
    render(<JsonTool />);

    const input = screen.getByPlaceholderText(/è¾“å…¥/i);
    await userEvent.type(input, '{"name":"John"}');

    await waitFor(() => {
      expect(screen.getByText(/"name"/)).toBeInTheDocument();
      expect(screen.getByText(/"John"/)).toBeInTheDocument();
    });
  });

  it('should show error for invalid JSON', async () => {
    render(<JsonTool />);

    const input = screen.getByPlaceholderText(/è¾“å…¥/i);
    await userEvent.type(input, '{"invalid":}');

    await waitFor(() => {
      expect(screen.getByText(/é”™è¯¯/i)).toBeInTheDocument();
    });
  });

  it('should copy output to clipboard', async () => {
    const mockWriteText = vi.fn().mockResolvedValue(undefined);
    global.navigator.clipboard = { writeText: mockWriteText } as any;

    render(<JsonTool />);

    const input = screen.getByPlaceholderText(/è¾“å…¥/i);
    await userEvent.type(input, '{"name":"John"}');

    await waitFor(() => {
      const copyButton = screen.getByText(/å¤åˆ¶/i);
      fireEvent.click(copyButton);
    });

    expect(mockWriteText).toHaveBeenCalled();
  });

  it('should upload JSON file', async () => {
    render(<JsonTool />);

    const file = new File(['{"name":"John"}'], 'test.json', { type: 'application/json' });
    const input = screen.getByLabelText(/ä¸Šä¼ æ–‡ä»¶/i) || screen.getByRole('button', { name: /ä¸Šä¼ /i });

    await userEvent.upload(input, file);

    await waitFor(() => {
      expect(screen.getByText(/"name"/)).toBeInTheDocument();
    });
  });
});
```

### 3.2 çŠ¶æ€ç®¡ç†æµ‹è¯•

```typescript
// tests/integration/stores/uiStore.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { useUIStore } from '@/stores/uiStore';

describe('UI Store', () => {
  beforeEach(() => {
    useUIStore.setState({
      theme: 'system',
      sidebarCollapsed: false,
      recentTools: [],
      favoriteTools: [],
    });
  });

  it('should set theme', () => {
    useUIStore.getState().setTheme('dark');
    expect(useUIStore.getState().theme).toBe('dark');
  });

  it('should toggle sidebar', () => {
    expect(useUIStore.getState().sidebarCollapsed).toBe(false);

    useUIStore.getState().toggleSidebar();
    expect(useUIStore.getState().sidebarCollapsed).toBe(true);

    useUIStore.getState().toggleSidebar();
    expect(useUIStore.getState().sidebarCollapsed).toBe(false);
  });

  it('should add recent tool', () => {
    useUIStore.getState().addRecentTool('json-formatter');
    expect(useUIStore.getState().recentTools).toEqual(['json-formatter']);

    useUIStore.getState().addRecentTool('base64-encoder');
    expect(useUIStore.getState().recentTools).toEqual(['base64-encoder', 'json-formatter']);
  });

  it('should limit recent tools to 10', () => {
    for (let i = 0; i < 15; i++) {
      useUIStore.getState().addRecentTool(`tool-${i}`);
    }

    expect(useUIStore.getState().recentTools.length).toBe(10);
  });

  it('should toggle favorite tool', () => {
    useUIStore.getState().toggleFavorite('json-formatter');
    expect(useUIStore.getState().favoriteTools).toContain('json-formatter');

    useUIStore.getState().toggleFavorite('json-formatter');
    expect(useUIStore.getState().favoriteTools).not.toContain('json-formatter');
  });
});
```

---

## å››ã€E2Eæµ‹è¯•

### 4.1 å…³é”®æµç¨‹æµ‹è¯•

```typescript
// tests/e2e/json-tool.spec.ts
import { test, expect } from '@playwright/test';

test.describe('JSON Tool E2E', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/tools/json');
  });

  test('should format JSON input', async ({ page }) => {
    const input = page.locator('textarea[placeholder*="è¾“å…¥"]');
    await input.fill('{"name":"John","age":30}');

    const output = page.locator('textarea').nth(1);
    await expect(output).toContainText('"name"');
    await expect(output).toContainText('"age"');
  });

  test('should show validation error', async ({ page }) => {
    const input = page.locator('textarea[placeholder*="è¾“å…¥"]');
    await input.fill('{"invalid":}');

    const errorMessage = page.locator('text=/é”™è¯¯/i');
    await expect(errorMessage).toBeVisible();
  });

  test('should copy result to clipboard', async ({ page, context }) => {
    await context.grantPermissions(['clipboard-read']);

    const input = page.locator('textarea[placeholder*="è¾“å…¥"]');
    await input.fill('{"test":true}');

    const copyButton = page.locator('button:has-text("å¤åˆ¶")');
    await copyButton.click();

    const clipboardText = await page.evaluate(() => navigator.clipboard.readText());
    expect(clipboardText).toContain('"test"');
  });

  test('should upload file', async ({ page }) => {
    const fileInput = page.locator('input[type="file"]');
    await fileInput.setInputFiles({
      name: 'test.json',
      mimeType: 'application/json',
      buffer: Buffer.from('{"uploaded":true}'),
    });

    const output = page.locator('textarea').nth(1);
    await expect(output).toContainText('"uploaded"');
  });

  test('should download result', async ({ page, download }) => {
    const input = page.locator('textarea[placeholder*="è¾“å…¥"]');
    await input.fill('{"download":true}');

    const downloadPromise = page.waitForEvent('download');
    await page.locator('button:has-text("ä¸‹è½½")').click();
    const downloadable = await downloadPromise;

    expect(downloadable.suggestedFilename()).toMatch(/\.json$/);
  });
});
```

### 4.2 è·¨å·¥å…·æµç¨‹æµ‹è¯•

```typescript
// tests/e2e/cross-tool-workflow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Cross Tool Workflow', () => {
  test('should convert JSON to CSV and download', async ({ page }) => {
    // å¯¼èˆªåˆ°JSONå·¥å…·
    await page.goto('/tools/json');

    // è¾“å…¥JSONæ•°æ®
    const input = page.locator('textarea[placeholder*="è¾“å…¥"]').first();
    await input.fill('[{"name":"John","age":30},{"name":"Jane","age":25}]');

    // ç‚¹å‡»è½¬æ¢ä¸ºCSV
    await page.locator('button:has-text("CSV")').click();

    // éªŒè¯è¾“å‡º
    const output = page.locator('textarea').nth(1);
    await expect(output).toContainText('name,age');

    // ä¸‹è½½CSV
    const downloadPromise = page.waitForEvent('download');
    await page.locator('button:has-text("ä¸‹è½½")').click();
    const downloadable = await downloadPromise;
    expect(downloadable.suggestedFilename()).toMatch(/\.csv$/);
  });

  test('should search and navigate to tool', async ({ page }) => {
    await page.goto('/');

    // æœç´¢å·¥å…·
    const searchInput = page.locator('input[placeholder*="æœç´¢"]');
    await searchInput.fill('base64');

    // ç‚¹å‡»æœç´¢ç»“æœ
    await page.locator('text=/Base64.*ç¼–è§£ç /').click();

    // éªŒè¯å¯¼èˆª
    await expect(page).toHaveURL(/\/tools\/base64/);
    await expect(page.locator('h1')).toContainText('Base64');
  });
});
```

---

## äº”ã€æ€§èƒ½æµ‹è¯•

### 5.1 å¤§æ–‡ä»¶å¤„ç†æµ‹è¯•

```typescript
// tests/performance/large-file.test.ts
import { test, expect } from '@playwright/test';

test.describe('Large File Performance', () => {
  test('should handle large JSON file (10MB)', async ({ page }) => {
    await page.goto('/tools/json');

    // ç”Ÿæˆå¤§å‹JSONæ–‡ä»¶
    const largeJson = generateLargeJson(10000); // 10,000ä¸ªå¯¹è±¡

    const input = page.locator('textarea[placeholder*="è¾“å…¥"]').first();
    await input.fill(largeJson);

    // ç­‰å¾…æ ¼å¼åŒ–å®Œæˆï¼ˆåº”è¯¥åœ¨5ç§’å†…å®Œæˆï¼‰
    const output = page.locator('textarea').nth(1);
    await expect(output).toContainText('"id"', { timeout: 5000 });
  });

  test('should format 1MB JSON in under 1 second', async ({ page }) => {
    await page.goto('/tools/json');

    const startTime = Date.now();
    const largeJson = generateLargeJson(1000);

    await page.locator('textarea[placeholder*="è¾“å…¥"]').first().fill(largeJson);
    await page.locator('textarea').nth(1).waitFor({ state: 'visible' });

    const endTime = Date.now();
    expect(endTime - startTime).toBeLessThan(1000);
  });

  function generateLargeJson(count: number): string {
    const data = [];
    for (let i = 0; i < count; i++) {
      data.push({
        id: i,
        name: `User ${i}`,
        email: `user${i}@example.com`,
        created: new Date().toISOString(),
      });
    }
    return JSON.stringify(data);
  }
});
```

---

## å…­ã€æµ‹è¯•é…ç½®

### 6.1 Vitesté…ç½®

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './tests/setup.ts',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.config.*',
        '**/dist/',
      ],
      thresholds: {
        statements: 80,
        branches: 80,
        functions: 80,
        lines: 80,
      },
    },
  },
});
```

### 6.2 Playwrighté…ç½®

```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: [
    ['html'],
    ['json', { outputFile: 'test-results/results.json' }],
    ['junit', { outputFile: 'test-results/results.xml' }],
  ],
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

---

## ä¸ƒã€å¼€å‘æµç¨‹

### 7.1 Gitå·¥ä½œæµ

```bash
# 1. ä»mainåˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout main
git pull
git checkout -b feature/json-tool

# 2. å¼€å‘åŠŸèƒ½
git add .
git commit -m "feat(json): implement JSON formatter tool"

# 3. æ¨é€å¹¶åˆ›å»ºPR
git push origin feature/json-tool

# 4. ä»£ç å®¡æŸ¥é€šè¿‡ååˆå¹¶åˆ°main
# 5. åˆ é™¤åŠŸèƒ½åˆ†æ”¯
git branch -d feature/json-tool
```

### 7.2 æäº¤è§„èŒƒ

```bash
# feat: æ–°åŠŸèƒ½
git commit -m "feat(tools): add base64 encoder tool"

# fix: ä¿®å¤bug
git commit -m "fix(json): resolve issue with unicode characters"

# docs: æ–‡æ¡£
git commit -m "docs(readme): update installation instructions"

# style: ä»£ç æ ¼å¼
git commit -m "style(ui): format button component"

# refactor: é‡æ„
git commit -m "refactor(storage): migrate to IndexedDB"

# perf: æ€§èƒ½ä¼˜åŒ–
git commit -m "perf(json): implement lazy loading for large files"

# test: æµ‹è¯•
git commit -m "test(json): add unit tests for json parser"

# chore: æ„å»º/å·¥å…·é“¾
git commit -m "chore(deps): upgrade react to v18"
```

### 7.3 ä»£ç å®¡æŸ¥æ¸…å•

- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] æœ‰é€‚å½“çš„æ³¨é‡Š
- [ ] æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- [ ] æ²¡æœ‰console.logé—ç•™
- [ ] æ²¡æœ‰TODOæ³¨é‡Šï¼ˆæˆ–å·²åˆ›å»ºissueï¼‰
- [ ] ç±»å‹å®šä¹‰å®Œæ•´
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ€§èƒ½è€ƒè™‘ï¼ˆå¤§æ–‡ä»¶ã€å†…å­˜ç­‰ï¼‰
- [ ] å¯è®¿é—®æ€§è€ƒè™‘ï¼ˆariaæ ‡ç­¾ç­‰ï¼‰
- [ ] å“åº”å¼è®¾è®¡
- [ ] æš—è‰²æ¨¡å¼æ”¯æŒ
- [ ] æ–‡æ¡£å·²æ›´æ–°

### 7.4 CI/CDæµç¨‹

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  lint-and-test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run linter
        run: npm run lint

      - name: Run type check
        run: npm run type-check

      - name: Run unit tests
        run: npm run test:unit

      - name: Generate coverage
        run: npm run test:coverage

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/coverage-final.json

      - name: Build
        run: npm run build

      - name: Run E2E tests
        run: npm run test:e2e

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: test-results/

  deploy:
    needs: lint-and-test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - uses: actions/checkout@v3

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
          vercel-args: '--prod'
```

---

## å…«ã€è´¨é‡é—¨ç¦

### 8.1 Pre-commitæ£€æŸ¥

```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write",
      "vitest related --run"
    ],
    "*.{css,scss}": [
      "stylelint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  }
}
```

### 8.2 PRæ£€æŸ¥æ¸…å•

```yaml
# .github/PULL_REQUEST_TEMPLATE.md
## PR Checklist

- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ (`npm run test:unit`)
- [ ] E2Eæµ‹è¯•é€šè¿‡ (`npm run test:e2e`)
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ²¡æœ‰TypeScripté”™è¯¯ (`npm run type-check`)
- [ ] æ²¡æœ‰ESLinté”™è¯¯ (`npm run lint`)
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] CHANGELOGå·²æ›´æ–°

## æè¿°

<!-- æè¿°è¿™ä¸ªPRåšäº†ä»€ä¹ˆ -->

## æµ‹è¯•

<!-- æè¿°å¦‚ä½•æµ‹è¯•è¿™ä¸ªæ”¹åŠ¨ -->

## æˆªå›¾

<!-- å¦‚æœæœ‰UIæ”¹åŠ¨ï¼Œè¯·æä¾›æˆªå›¾ -->
```

---

## ä¹ã€å‘å¸ƒæµç¨‹

### 9.1 ç‰ˆæœ¬å·è§„èŒƒ (è¯­ä¹‰åŒ–ç‰ˆæœ¬)

```
MAJOR.MINOR.PATCH

MAJOR: ä¸å…¼å®¹çš„APIå˜æ›´
MINOR: å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢
PATCH: å‘åå…¼å®¹çš„bugä¿®å¤

ç¤ºä¾‹: 1.0.0 â†’ 1.0.1 â†’ 1.1.0 â†’ 2.0.0
```

### 9.2 å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] CHANGELOGå·²æ›´æ–°
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–°
- [ ] Gitæ ‡ç­¾å·²åˆ›å»º
- [ ] Release noteså·²ç¼–å†™

### 9.3 å‘å¸ƒè„šæœ¬

```bash
#!/bin/bash
# scripts/release.sh

VERSION=$1

if [ -z "$VERSION" ]; then
  echo "Usage: ./release.sh <version>"
  exit 1
fi

# æ›´æ–°ç‰ˆæœ¬å·
npm version $VERSION

# ç”ŸæˆCHANGELOG
npm run changelog

# æäº¤
git add .
git commit -m "chore(release): bump version to $VERSION"

# æ‰“æ ‡ç­¾
git tag -a v$VERSION -m "Release v$VERSION"

# æ¨é€
git push origin main
git push origin v$VERSION

# å‘å¸ƒåˆ°npm (å¦‚æœéœ€è¦)
npm publish
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2025-01-30
